node{
  try {
    stage('Static Analysis') {
      withSonarQubeEnv('SonarQube installation') {

      }
    }

    stage('Quality Gate') {
      timeout(time: 1, unit: 'HOURS') {
        def qg = waitForQualityGate()
        if (qg.status != 'OK') {
          error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }
      }
      echo 'Quality Gate Passed'
    }

  } catch (Exception e) {
    echo "Error: ${e.message}"
    currentBuild.result = 'FAILURE'
    throw e
  }
}